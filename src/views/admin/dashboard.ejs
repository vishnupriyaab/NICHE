<%- include('include/_header') %>

    <section class="content-main">
        <div class="content-header">
            <div>
                <h2 class="content-title card-title">Dashboard</h2>
                <p>Whole data about your business here</p>
            </div>
            <div>
                <a href="/salesReport" class="btn btn-primary"><i
                        class="text-muted material-icons md-post_add"></i>Sales report</a>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-primary-light"><i
                                class="text-primary material-icons md-monetization_on"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Total Revenue</h6>
                            <span>â‚¹ <%= totalPrice %></span>
                            <!-- <span class="text-sm"> Shipping fees are not included </span> -->
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-success-light"><i
                                class="text-success material-icons md-local_shipping"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Orders</h6>
                            <span>
                                <%= totalOrderCount %>
                            </span>
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-warning-light"><i
                                class="text-warning material-icons md-qr_code"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Users</h6>
                            <span>
                                <%= userCount %>
                            </span>
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-info-light"><i
                                class="text-info material-icons md-shopping_basket"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Products</h6>
                            <span>
                                <%= productCount %>
                            </span>
                        </div>
                    </article>
                </div>
            </div>
        </div>
        <div class="row" style="width: 100%;">
            <div class="row" style="width: 100%;">
                <div class="row">
                    <div class="col-xl-8 col-lg-12" style="width: 100%;">
                        <div class="row">
                            <div style=" width: 100%;">
                            <h3 class="text-center">Sales Chart</h3>
                        </div>
                            <select id="intervalSelect" onchange="updateChart()"
                                style="background-color: rgb(255, 255, 255); width: 100px; height: 25px; margin-top: 10px; margin-left: 10px;">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                            <div style="width: 100%;">
                                <canvas id="myChart6"></canvas>
                            </div>
                        </div>
                    <div class="d-flex gap-5 w-100 justify-content-center shadow-sm" style="height: 300px; margin-top: 50px; border: 1px solid black; border-radius: 4px; ">
                        <div style="margin-top: 40px;">
                            <h3 class="mt-5" style="text-align: center;">Best Selling Products</h3>
                            <table style="border: 1px solid black; width: 373px;" class="mt-5">
                                <thead style="border: 1px solid black;">
                                    <tr style="border: 1px solid black;">
                                        <th style="border: 1px solid black; text-align: center; font-size: large; background-color: rgb(240, 235, 235);">Product Name</th>
                                        <th style="width: max-content; border: 1px solid black; font-size: large; background-color: rgb(240, 235, 235);" class="text-center">Quantity Sold</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% bestSellingProducts.forEach(product=> { %>
                                        <tr  style="border: 1px solid black; width: 100%;">
                                            <td style=" width: 70%; border: 1px solid black; text-align: center;">
                                                <%= product._id %>
                                            </td>
                                            <td style="width: 30%;" class="text-center">
                                                <%= product.count %>
                                            </td>
                                        </tr>
                                        <% }); %>
                                </tbody>
                            </table>
                        </div>
                        <div style="margin-top: 40px;">
                            <h3 class="mt-5" style="text-align: center;">Best Selling Category</h3>
                            <table style="border: 1px solid black; width: 373px;" class="mt-5">
                                <thead style="border: 1px solid black;">
                                    <tr style="border: 1px solid black;">
                                        <th style="border: 1px solid black; text-align: center; font-size: large; background-color: rgb(240, 235, 235);">Category Name</th>
                                        <th style="width: max-content; border: 1px solid black; font-size: large; background-color: rgb(240, 235, 235);" class="text-center">Quantity Sold</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% bestSellingCategory.forEach(product=> { %>
                                        <tr  style="border: 1px solid black; width: 100%;">
                                            <td style=" width: 70%; border: 1px solid black; text-align: center;">
                                                <%= product.categoryName %>
                                            </td>
                                            <td style="width: 30%;" class="text-center">
                                                <%= product.count %>
                                            </td>
                                        </tr>
                                        <% }); %>
                                </tbody>
                            </table>
                        </div>
                       
                    </div>

    </section>

    <!-- content-main end// -->
    <%- include('include/_footer') %>

        </main>
        <script src="/js/vendors/jquery-3.6.0.min.js"></script>
        <script src="/js/vendors/bootstrap.bundle.min.js"></script>
        <script src="/js/vendors/select2.min.js"></script>
        <script src="/js/vendors/perfect-scrollbar.js"></script>
        <script src="/js/vendors/jquery.fullscreen.min.js"></script>
        <script src="/js/vendors/chart.js"></script>
        <!-- Main Script -->
        <script src="/js/main.js?v=1.1" type="text/javascript"></script>
        <script src="/js/custom-chart.js" type="text/javascript"></script>
        </body>

        </html>



        <script>
            // Function to update chart based on selected interval
            function updateChart() {
                var interval = document.getElementById('intervalSelect').value;

                // Making AJAX request
                $.ajax({
                    type: 'POST',
                    url: '/admin/chartData',
                    data: { filter: interval },
                    success: function (response) {

                        var labels = response.label;
                        var salesCount = response.salesCount;

                        myChart.data.labels = labels;
                        myChart.data.datasets[0].data = salesCount;
                        myChart.update();
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            }

            var data = {
                labels: [],
                datasets: [{
                    label: 'Sales Count',
                    backgroundColor: '#27ae60',
                    borderColor: 'rgb(255, 99, 132)',
                    data: []
                }]
            };

            var config = {
                type: 'line',
                data: data,
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            };

            var ctx = document.getElementById('myChart6').getContext('2d');
            var myChart = new Chart(ctx, config);
            updateChart();
        </script>